Web-App для визулизации и анализа данных в фреймворке [Dash](dash.plot.ly).

## Содержание
   * [Как оно работает](#как-оно-работает)
   * [Конфигурирование](#конфигурирование)

## Как оно работает
В [app.py](app.py) вводится `app.layout` - HTML теги на странице, после чего импортируются хэндлеры из [callbacks.py](callbacks.py).<br>
Делается это именно в таком порядке, потому что [callbacks.py](callbacks.py) внутри импортирует объект фласкового приложения `app` (который к этому моменту должен иметь заполненный аттрибут `layout` ).

Хэндлеры в [callbacks.py](callbacks.py) реагируют на взаимодействие юзера со страницей. Их цель - парсить выбранные юзером параметры, упаковывать их в SQL запрос с помощью `QueryConstructor` ([utils.py](utils.py)), запрашивать данные и отображать их на странице.

## Конфигурирование
Файл для инициализации конфига довольно короткий и простой, поэтому просто просмотрев его (вместе с юзером), можно понять что и как конфигурируется.

**USERS**<br>
Пары логин/пароль для авторизации.

**APP_NAMES, PLATFORMS, COHORTS**<br>
Опции, доступные для выбора на странице в соответствующих дропдаунах/переключателях.

**WHALE_THRESHOLDS**<br>
Границы определения китов по когортам. Определялись как 99% (или чуть больше) квантили по всем проектам.

**SPECIAL_MEDIAS, MediaToTable, AD_METRICS**<br>
В `SPECIAL_MEDIAS` вводятся те источники данных, затраты по которым наш ETL подтягивает в БД в выделенные таблицы.<br>
В `MediaToTable` указываем их соответствующие таблицы в БД.<br>
В `AD_METRICS` указываем прочие рекламные метрики, которые содержатся в таблицах каждого источника.

**GROUPERS**<br>
Этот словарь используется для подтягивания доступных разбивок данных (элемент `Group by` на странице).<br>
Принцип действия можно посмотреть в хэндлере `set_groupby_options` в [callbacks.py](callbacks.py).<br>
**Почему нужно ограничивать список доступных разбивок в зависимости от выбранного медиа (элемент `Media Source` на странице)?**<br>
Все разбивки, которые юзер только может выбрать, есть только в таблицах Аппсфлаера. Таблицы для особых медиа (`SPECIAL_MEDIAS`) содержат лишь малое подмножество колонок Аппсфлаера. Поэтому нам нужно ограничивать набор доступных разбивок, чтобы в эти особые таблицы не полетел запрос на те колонки, которых там нет.<br>
В `GROUPERS` также содержится список разбивок `dynamics_graph` для отображения разбивок в секции Dynamics на странице и `dynamics_ts` для доступных разбивок по временному признаку в это же секции.
